## Next Steps:

*Goal: [Describe next major goal here]*

[List next steps here]

## Completed Tasks

1.  **Implement Client-Side Diagram Export:**
    *   *Goal: Replace backend `mmdc`-based export with client-side `mermaid.min.js`.*
    *   Modified webview template (`src/views/mermaid-webview-template.ts`) to include "Export SVG" and "Export PNG" buttons.
    *   Added JavaScript logic to the webview for SVG export (`Blob`, `URL.createObjectURL`) and PNG export (`Canvas`, `Image`, `toBlob`).
    *   Removed SVG/PNG export logic using `@mermaid-js/mermaid-cli` from the `diagram.saveAs` command handler in `src/extension.ts`.
    *   Removed the `@mermaid-js/mermaid-cli` dependency from `package.json`.

2.  **Add a dropdown that can change the theme of the diagram.**
    *   Added a `<select>` dropdown to the webview HTML generated by `/simpleUML`, `/relationUML`, and the `RenderDiagramTool` (in `src/tool-handlers.ts`).
    *   Added JavaScript to handle dropdown changes, re-initializing/re-rendering the Mermaid diagram with the selected theme (`default`, `neutral`, `dark`, `forest`).
    *   Set `retainContextWhenHidden: true` for webviews to preserve theme selection.
2.  **Add a "Save Diagram" Button:**
    1.  **Declare Command:** Defined `diagram.saveAs` in `package.json`.
    2.  **Register Command:** Registered handler in `extension.ts` using `vscode.commands.registerCommand`, implementing save dialog and file writing.
    3.  **Create Button Command:** Created `vscode.Command` object in the `/fromCurrentFile` and `/showConnections` handlers in `src/simple.ts`.
    4.  **Add Button to Stream:** Called `stream.button()` in the `/fromCurrentFile` and `/showConnections` handlers to display the button.

3.  **Bug Fixes:**
    *   Fixed webview panel rendering regression in `RenderDiagramTool`

4.  **Command Structure Cleanup:**
    *   Removed `/randomTeach` endpoint
    *   Removed `/play` endpoint
    *   Simplified command structure to focus on diagram-related functionality

5.  **Tool Implementation:**
    *   Implemented proper tool classes with `vscode.LanguageModelTool` interface
    *   Created `GetCodeContextTool` and `RenderDiagramTool` classes
    *   Fixed tool result handling with proper types
    *   Added tool registration in `src/diagram-tools.ts`

6.  **Auto-Detection of Diagram Type:**
    *   Updated prompts and tool handling to automatically detect appropriate diagram types
    *   Implemented code analysis for diagram type selection
    *   Added requirement for model to explain diagram type choices

7.  **Documentation Updates:**
    *   Updated README.md to reflect new diagram-focused functionality
    *   Added documentation for `/fromCurrentFile` command
    *   Updated current state and next steps documentation

8.  **Connection Visualization:**
    *   Implemented `/showConnections` command to show object relationships
    *   Added support for inheritance, composition, and aggregation relationships
    *   Enhanced diagram generation to include related objects and their connections
    *   Added dark mode support for connection diagrams

9.  **Implement PNG/SVG Rendering for Save:**
    *   Integrated the Mermaid CLI (`mmdc`) via `@mermaid-js/mermaid-cli` dev dependency.
    *   Modified the `diagram.saveAs` command handler in `src/extension.ts` to render PNG/SVG using `mmdc`.
    *   Writes image data for `.png` and `.svg` extensions.
    *   Added error handling for `mmdc` execution (not found, rendering errors).
    *   Checks for `mmdc` existence before attempting render.

10. **Improved Save Diagram Functionality:**
    *   Used the Mermaid CLI (`mmdc`) to convert diagrams to SVG/PNG on save.
    *   Checked if `mmdc` is installed; prompt user if not.
    *   Handled `.svg`, `.png`, `.mmd`, and `.md` file extensions during save.
    *   Used `child_process` to run `mmdc`.
    *   Added error handling for the conversion process.

### 3. Add Export/Save Functionality

*Goal: Allow users to save the generated Mermaid diagrams in various formats.* Currently implemented for diagrams generated via `/simpleUML`, `/relationUML`, and `/sequence` command (via the `renderDiagram` tool).

1.  **Define Export Formats:** Decided on `.mmd` (raw syntax), `.md` (Markdown code block), `.svg`, and `.png`.
2.  **Webview Controls:**
    *   Added an "Export Diagram" button/dropdown to the webview HTML (`src/views/mermaid-webview-template.ts`).
    *   The dropdown lists the export formats (SVG, PNG, MMD, MD).
    *   Added JavaScript in the webview to handle button clicks/dropdown selections and send a `postMessage` back to the extension with the desired format, current theme, and the original Mermaid syntax.
3.  **Register `